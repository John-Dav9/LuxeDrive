<div class="container-fluid">
  <div class="admin-page-header">
    <p class="header-eyebrow">Super Admin</p>
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <h1 class="header-title">
          <span class="header-icon">üë§</span>
          <%= @user.full_name %>
        </h1>
        <p class="header-subtitle mb-0"><%= @user.email %></p>
      </div>
      <div>
        <%= link_to "‚Üê Retour", super_admin_users_path, class: "btn btn-outline-light" %>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Informations utilisateur -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm mb-4 admin-table-card">
        <div class="card-header bg-white">
          <h5 class="mb-0">Informations</h5>
        </div>
        <div class="card-body">
          <table class="table table-sm admin-table">
            <tr>
              <th>ID</th>
              <td><code><%= @user.id %></code></td>
            </tr>
            <tr>
              <th>Pr√©nom</th>
              <td><%= @user.first_name %></td>
            </tr>
            <tr>
              <th>Nom</th>
              <td><%= @user.last_name %></td>
            </tr>
            <tr>
              <th>Email</th>
              <td><%= @user.email %></td>
            </tr>
            <tr>
              <th>R√¥le actuel</th>
              <td>
                <% if @user.super_admin? %>
                  <span class="badge bg-danger">üîß Super Admin</span>
                <% elsif @user.admin_client? %>
                  <span class="badge bg-success">üöó Propri√©taire</span>
                <% else %>
                  <span class="badge bg-info">üë§ Visiteur</span>
                <% end %>
              </td>
            </tr>
            <tr>
              <th>Inscrit le</th>
              <td><%= @user.created_at.strftime("%d/%m/%Y √† %H:%M") %></td>
            </tr>
            <tr>
              <th>Derni√®re MAJ</th>
              <td><%= @user.updated_at.strftime("%d/%m/%Y √† %H:%M") %></td>
            </tr>
          </table>
        </div>
      </div>

      <!-- Changer le r√¥le -->
      <div class="card border-0 shadow-sm admin-table-card">
        <div class="card-header bg-white">
          <h5 class="mb-0">Changer le r√¥le</h5>
        </div>
        <div class="card-body">
          <% if @user == current_user %>
            <div class="alert alert-warning mb-0">
              <i class="fas fa-exclamation-triangle me-2"></i>
              Vous ne pouvez pas modifier votre propre r√¥le.
            </div>
          <% else %>
            <%= form_with url: change_role_super_admin_user_path(@user), method: :patch do |f| %>
              <div class="mb-3">
                <%= f.label :role, "Nouveau r√¥le", class: "form-label" %>
                <%= f.select :role, 
                    options_for_select([
                      ["Super Admin", "super_admin"],
                      ["Propri√©taire de voitures", "admin_client"],
                      ["Visiteur", "visitor"]
                    ], @user.role), 
                    {}, 
                    class: "form-select" %>
              </div>
              <%= f.submit "Changer le r√¥le", class: "btn btn-primary w-100", data: { turbo_confirm: "√ätes-vous s√ªr de vouloir changer le r√¥le de cet utilisateur ?" } %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Statistiques et activit√© -->
    <div class="col-lg-8">
      <!-- Stats -->
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="card border-0 bg-primary text-white">
            <div class="card-body text-center">
              <h3 class="mb-0"><%= @user.cars.count %></h3>
              <small>Voitures</small>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card border-0 bg-success text-white">
            <div class="card-body text-center">
              <h3 class="mb-0"><%= @user.bookings.count %></h3>
              <small>R√©servations faites</small>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card border-0 bg-warning text-white">
            <div class="card-body text-center">
              <h3 class="mb-0"><%= @user.bookings_as_owner.count %></h3>
              <small>R√©servations re√ßues</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Voitures -->
      <div class="card border-0 shadow-sm mb-4 admin-table-card">
        <div class="card-header bg-white">
          <h5 class="mb-0">Voitures (<%= @user.cars.count %>)</h5>
        </div>
        <div class="card-body">
          <% if @user.cars.any? %>
            <div class="table-responsive">
              <table class="table table-sm admin-table">
                <thead>
                  <tr>
                    <th>Voiture</th>
                    <th>Cat√©gorie</th>
                    <th>Prix/jour</th>
                    <th>Statut</th>
                    <th>R√©servations</th>
                  </tr>
                </thead>
                <tbody>
                  <% @user.cars.each do |car| %>
                    <tr>
                      <td><strong><%= car.brand %> <%= car.model %></strong></td>
                      <td><span class="badge bg-secondary"><%= car.category %></span></td>
                      <td><%= number_to_currency(car.price, unit: "‚Ç¨") %></td>
                      <td>
                        <% if car.status %>
                          <span class="badge bg-success">Disponible</span>
                        <% else %>
                          <span class="badge bg-secondary">Indisponible</span>
                        <% end %>
                      </td>
                      <td><%= car.bookings.count %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <p class="text-muted mb-0">Aucune voiture</p>
          <% end %>
        </div>
      </div>

      <!-- R√©servations -->
      <div class="card border-0 shadow-sm admin-table-card">
        <div class="card-header bg-white">
          <h5 class="mb-0">R√©servations r√©centes (<%= @user.bookings.count %>)</h5>
        </div>
        <div class="card-body">
          <% if @user.bookings.any? %>
            <div class="table-responsive">
              <table class="table table-sm admin-table">
                <thead>
                  <tr>
                    <th>Voiture</th>
                    <th>Dates</th>
                    <th>Prix</th>
                    <th>Statut</th>
                  </tr>
                </thead>
                <tbody>
                  <% @user.bookings.order(created_at: :desc).limit(10).each do |booking| %>
                    <tr>
                      <td><strong><%= booking.car.brand %> <%= booking.car.model %></strong></td>
                      <td><small><%= booking.checkin_date.strftime("%d/%m/%Y") %> - <%= booking.checkout_date.strftime("%d/%m/%Y") %></small></td>
                      <td><%= number_to_currency(booking.total_price, unit: "‚Ç¨") %></td>
                      <td>
                        <% case booking.status %>
                        <% when 'pending_payment' %>
                          <span class="badge bg-secondary">Paiement en attente</span>
                        <% when 'pending' %>
                          <span class="badge bg-warning">En attente</span>
                        <% when 'accepted' %>
                          <span class="badge bg-success">Accept√©e</span>
                        <% when 'rejected' %>
                          <span class="badge bg-danger">Refus√©e</span>
                        <% when 'cancelled' %>
                          <span class="badge bg-secondary">Annul√©e</span>
                        <% when 'expired' %>
                          <span class="badge bg-dark">Expir√©e</span>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <p class="text-muted mb-0">Aucune r√©servation</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="card border-0 shadow-sm mt-4 admin-table-card">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <%= link_to "‚úèÔ∏è Modifier", edit_super_admin_user_path(@user), class: "btn btn-warning" %>
        <% unless @user == current_user %>
          <%= link_to "üóëÔ∏è Supprimer l'utilisateur", 
              super_admin_user_path(@user), 
              data: { turbo_method: :delete, turbo_confirm: "√ätes-vous s√ªr ? Cette action est irr√©versible." }, 
              class: "btn btn-danger" %>
        <% end %>
      </div>
    </div>
  </div>
</div>
